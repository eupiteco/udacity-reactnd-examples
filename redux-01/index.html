<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<Title> Redux UI</Title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>
		<script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>
		<script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>
		<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
		<script src="https://tylermcginnis.com/goals-todos-api/index.js"></script>
	<style>
		html {
			font-family: sans-serif;
		}
		body {
			margin: 0 auto;
			max-width: 640px;
		}
		#app {
			display: flex;
			justify-content: space-between;
		}
		.list {
			width: 250px;
		}
	</style>
	</head>
	<body>
		<!--h1>Learning redux</h1>
		<div id="app">
			<div id="todo-list" class="list">
				<h2>Todos</h2>
				<input type="text" placeholder="Add todo" id="todo-input"/>
				<button id="todo-btn">+</button>
				<ul id="todo-items">
				</ul>
			</div>
			<div id="goal-list" class="list">
				<h2>Goals</h2>
				<input type="text" placeholder="Add goal" id="goal-input"/>
				<button id="goal-btn">+</button>
				<ul id="goal-items">
				</ul>
			</div>
		</div>
		<hr/-->
		<div id="react-app"></div>
		<script type="text/javascript" src="index.js"></script>
		<script type="text/babel">

			const List = ({items, removeItem, toggleItem}) => (
				<ul>
					{
						items.map((item) => (
							<li key={item.id}>
								<span
									onClick={() => {toggleItem && toggleItem(item.id)}}
									style={{textDecoration: item.complete ? 'line-through' : 'none'}}
								>{item.name}</span>
								<button onClick={() => removeItem(item)}>X</button>
							</li>
						))
					}
				</ul>
			)

			class Todos extends React.Component {

				addItem = (e) => {
					e.preventDefault()
					const name = this.input.value
					return API.saveTodo(name)
						.then((todo) => {
							this.props.store.dispatch(addTodoAction(todo))
							this.input.value = ''
						})
						.catch(() => { alert('Someting went wrong. Try again.')})
				}

				removeItem = (todo) => {
					this.props.store.dispatch(removeTodoAction(todo.id))
					return API.deleteTodo(todo.id)
						.catch(() => {
							this.props.store.dispatch(addTodoAction(todo))
							alert('An error occoured. Try again.')
						})
				}

				toggleItem = (id) => {
					this.props.store.dispatch(toggleTodoAction(id))
					return API.saveTodoToggle(id)
						.catch(() => {
							this.props.store.dispatch(toggleTodoAction(id))
							alert('An error occoured. Try again.')
						})
				}

				render() {
					return(
						<div>
							<h1>TODOS</h1>
							<input
								type="text"
								placeholder="Add Todo"
								ref={(input) => this.input = input}
							/>
							<button onClick={this.addItem}>+</button>
							<List
								items={this.props.todos}
								removeItem={this.removeItem}
								toggleItem={this.toggleItem}
							/>
						</div>
					)
				}
			}

			class Goals extends React.Component {

				addItem = (e) => {
					e.preventDefault()
					const name = this.input.value
					return API.saveTodo(name)
						.then((goal) => {
							this.props.store.dispatch(addGoalAction(goal))
							this.input.value = ''
						})
						.catch(() => { alert('Someting went wrong. Try again.')})
				}

				removeItem = (goal) => {
					this.props.store.dispatch(removeGoalAction(goal.id))
					return API.deleteGoal(goal.id)
						.catch(() => {
							this.props.store.dispatch(addGoalAction(goal))
							alert('An error occoured. Try again.')
						})
				}

				render() {
					return(
						<div>
							<h1>GOALS</h1>
							<input
								type="text"
								placeholder="Add Goal"
								ref={(input) => this.input = input}
							/>
							<button onClick={this.addItem}>+</button>
							<List
								items={this.props.goals}
								removeItem={this.removeItem}
							/>
						</div>
					)
				}
			}

			class App extends React.Component {
				componentDidMount() {
					const { store } = this.props

					Promise.all([
						API.fetchTodos(),
						API.fetchGoals()
					]).then(([todos, goals]) => {
						store.dispatch(receiveDataAction(todos, goals))
					})
					store.subscribe(() => this.forceUpdate())
				}
				render() {
					const { store } = this.props
					const { todos, goals, loading } = store.getState()
					if (loading === true) return <h3>Loading data...</h3>
					return (
						<div>
							<Todos todos={todos} store={this.props.store}/>
							<Goals goals={goals} store={this.props.store}/>
						</div>
					)
				}
			}
			ReactDOM.render(
				<App store={store}/>,
				document.getElementById('react-app')
			)
		</script>
	</body>
</html>
